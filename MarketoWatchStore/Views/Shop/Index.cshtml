@model ShopVM
@{ ViewBag.Title = "Shop | Marketo";
    int inputId = 0; }

<!-- Breadcrumb section start -->
<section class="breadcrumb-section section-b-space">
    <ul class="circles">
        @for (int i = 1; i <= 10; i++)
        {
            <li></li>
        }
    </ul>
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h3>Shop</h3>
                <nav>
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="index.html">
                                <i class="fas fa-home"></i>
                            </a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">Shop</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</section>
<!-- Breadcrumb section end -->
<!-- Shop Section start -->
<section class="section-b-space">
    <div class="container">
        <div class="row">
            <div class="col-lg-3 col-md-4">
                <div class="category-option">
                    <div class="button-close mb-3">
                        <button class="btn p-0"><i data-feather="arrow-left"></i> Close</button>
                    </div>
                    <div class="accordion category-name" id="accordionExample">

                        <div class="accordion-item category-rating">
                            <h2 class="accordion-header" id="headingOne">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                                    Brand
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                                <div class="accordion-body category-scroll">
                                    <ul class="category-list">
                                        @foreach (Brand brand in Model.Brands)
                                        {
                                            <li>
                                                <div class="form-check ps-0 custom-form-check">
                                                    <input class="shopFilter brand checkbox_animated check-it" data-id="@brand.Id" type="checkbox" id="brand@(brand.Id)">
                                                    <label class="form-check-label" for="brand@(brand.Id)">@brand.Title</label>
                                                    <p class="font-light">(@brand.Products.Where(p => !p.IsDeleted).Count())</p>
                                                </div>
                                            </li>
                                        }
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item category-color">
                            <h2 class="accordion-header" id="headingTwo">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
                                    Colour
                                </button>
                            </h2>
                            <div id="collapseTwo" class="accordion-collapse collapse show" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
                                <div class="accordion-body">
                                    <ul class="category-list">
                                        @foreach (Colour colour in Model.Colours)
                                        {
                                            <li>
                                                <a asp-route-colourId="@colour.Id" data-id="@colour.Id" class="shopFilter color" style="background-color: @colour.Title;"></a>
                                            </li>
                                        }
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item category-price">
                            <h2 class="accordion-header" id="headingThree">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree">
                                    Price
                                </button>
                            </h2>
                            <div id="collapseThree" class="accordion-collapse collapse show" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
                                <div class="accordion-body">
                                    <div class="range-slider category-list">
                                        <input type="text" class="js-range-slider" value="" />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item category-rating">
                            <h2 class="accordion-header" id="headingFour">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour">
                                    Gender
                                </button>
                            </h2>
                            <div id="collapseFour" class="accordion-collapse collapse show" aria-labelledby="headingFour">
                                <div class="accordion-body category-scroll">
                                    <ul class="category-list">
                                        @foreach (var gender in Model.Genders)
                                        {
                                            <li>
                                                <div class="form-check ps-0 custom-form-check">
                                                    <input class="shopFilter gender checkbox_animated check-it" data-id="@((int)gender)" type="checkbox" id="gender@(++inputId)">
                                                    <label class="form-check-label" for="gender@(inputId)">
                                                        @gender
                                                    </label>
                                                    <p class="font-light">@Model.Products.Where(p => p.Gender == gender && !p.IsDeleted).Count()</p>
                                                </div>
                                            </li>
                                        }
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item category-rating">
                            <h2 class="accordion-header" id="headingFive">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive">
                                    Features
                                </button>
                            </h2>
                            <div id="collapseFive" class="accordion-collapse collapse show" aria-labelledby="headingFive">
                                <div class="accordion-body category-scroll">
                                    <ul class="category-list">
                                        @foreach (Feature feature in Model.Features)
                                        {
                                            <li>
                                                <div class="form-check ps-0 custom-form-check">
                                                    <input class="shopFilter feature checkbox_animated check-it" data-id="@feature.Id" type="checkbox" id="feature@(feature.Id)">
                                                    <label class="form-check-label" for="feature@(feature.Id)">
                                                        @feature.Title
                                                    </label>
                                                    <p class="font-light">(@(feature.ProductFeatures.Count()))</p>
                                                </div>
                                            </li>
                                        }
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item category-rating">
                            <h2 class="accordion-header" id="headingSix">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSix">
                                    Power Source
                                </button>
                            </h2>
                            <div id="collapseSix" class="accordion-collapse collapse show" aria-labelledby="headingSix">
                                <div class="accordion-body category-scroll">
                                    <ul class="category-list">
                                        @foreach (PowerSource powerSource in Model.PowerSources)
                                        {
                                            <li>
                                                <div class="form-check ps-0 custom-form-check">
                                                    <input class="shopFilter powerSource checkbox_animated check-it" type="checkbox" data-id="@powerSource.Id" id="powersource@(powerSource.Id)">
                                                    <label class="form-check-label" for="powersource@(powerSource.Id)">
                                                        @powerSource.Title
                                                    </label>
                                                    <p class="font-light">(@(powerSource.Products.Where(p => !p.IsDeleted).Count()))</p>
                                                </div>
                                            </li>
                                        }
                                    </ul>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <div class="col-lg-9 col-12 ratio_30">
                @foreach (AdsBanner adsBanner in Model.AdsBanners)
                {
                    <div class="banner-deatils">
                        <a href="@((adsBanner.AdsUrl != null) ? adsBanner.AdsUrl : "javascript:void(0)")" target="@((adsBanner.AdsUrl != null) ? "_blank" : "_self")">
                            <div class="banner-image">
                                <img src="~/assets/images/banner/@adsBanner.Image" class="img-fluid bg-img blur-up lazyload" alt="banner-image">
                                <div class="banner-content">
                                    <div>
                                        <h3>@adsBanner.Title</h3>
                                        <p>@adsBanner.Text</p>
                                    </div>
                                </div>
                            </div>
                            <div class="banner-contain mt-3 mb-5">
                                <p class="font-light"> </p>
                            </div>
                        </a>
                    </div>
                }

                <div class="row g-4">

                    <!-- filter button -->
                    <div class="filter-button">
                        <button class="btn filter-btn p-0"><i data-feather="align-left"></i> Filter</button>
                    </div>
                    <!-- filter button -->

                </div>
                <!-- label and featured section -->
                <!-- Prodcut setion -->
                <div class="shop-products">
                    @await Html.PartialAsync("_ShopProductListPartial", Model.Products)
                </div>
                <!-- Prodcut setion -->
            </div>
        </div>
    </div>
</section>
<!-- Shop Section end -->

@section CSS{
    <link rel="stylesheet" href="~/assets/ion.rangeSlider/css/ion.rangeSlider.min.css">
}

@section JS{
    <script src="~/assets/js/price-filter.js"></script>
    <script src="~/assets/ion.rangeSlider/js/ion.rangeSlider.min.js"></script>
    <script src="~/assets/js/filter.js"></script>

    <script>
        //Shop filter
        $(document).on("click", ".shopFilter", function (e) {
            e.preventDefault();
            if ($(this).hasClass("brand")) {
                $(this).toggleClass("active-brand");
            }
            if ($(this).hasClass("color")) {
                $(this).toggleClass("active-color");
            }
            if ($(this).hasClass("gender")) {
                $(this).toggleClass("active-gender");
            }
            if ($(this).hasClass("feature")) {
                $(this).toggleClass("active-feature");
            }
            if ($(this).hasClass("powerSource")) {
                $(this).toggleClass("active-powerSource");
            }
            ShopFetch();
        })
        function ShopFetch() {
            var brandIds = document.querySelectorAll(".active-brand");
            var colorIds = document.querySelectorAll(".active-color");
            var genderIds = document.querySelectorAll(".active-gender");
            var featureIds = document.querySelectorAll(".active-feature");
            var powerSourceIds = document.querySelectorAll(".active-powerSource");
            var Bids = "";
            var Cids = "";
            var gids = "";
            var fids = "";
            var pids = "";
            //var minP = $(".irs-from").before();
            //var maxP = $(".irs-to").before();
            for (var i = 0; i < brandIds.length; i++) {
                Bids += brandIds[i].getAttribute("data-id") + ",";
            }
            for (var i = 0; i < colorIds.length; i++) {
                Cids += colorIds[i].getAttribute("data-id") + ",";
            }
            for (var i = 0; i < genderIds.length; i++) {
                gids += genderIds[i].getAttribute("data-id") + ",";
            }
            for (var i = 0; i < featureIds.length; i++) {
                fids += featureIds[i].getAttribute("data-id") + ",";
            }
            for (var i = 0; i < powerSourceIds.length; i++) {
                pids += powerSourceIds[i].getAttribute("data-id") + ",";
            }

            fetch("../../shop/filter"
                + "?brands=" + Bids.toString()
                + "&colors=" + Cids.toString()
                + "&genders=" + gids.toString()
                + "&features=" + fids.toString()
                + "&powers=" + pids.toString()
                //+ "&minPrice=" + parseInt(minP)
                //+ "&maxPrice=" + parseInt(maxP)
            ).then(res => {
                return res.text();
            }).then(data => {
                $(".shop-products").html(data);

                /* Feather JS */
                feather.replace();
            })
        }
    </script>
}

